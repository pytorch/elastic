


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torchelastic.tsm.driver.api &mdash; PyTorch/Elastic master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <div class="ecosystem-dropdown">
              <a id="dropdownMenuButton" data-toggle="ecosystem-dropdown">
                Ecosystem
              </a>
              <div class="ecosystem-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/hub"">
                  <span class=dropdown-title>Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class=dropdown-title>Tools & Libraries</span>
                  <p>Explore the ecosystem of tools and libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <div class="resources-dropdown">
              <a id="resourcesDropdownButton" data-toggle="resources-dropdown">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/resources"">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class=dropdown-title>About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  v0.2.1rc0
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../train_script.html">Train script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.html">Elastic Launch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agent.html">Elastic Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../timer.html">Expiration Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rendezvous.html">Rendezvous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../events.html">Events</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../customization.html">Customization</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../kubernetes.html">TorchElastic Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtime.html">Cloud Provider Support (Deprecated)</a></li>
</ul>
<p class="caption"><span class="caption-text">Experimental</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tsm_driver.html">Training Session Manager (TSM)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../index.html">Module code</a> &gt;</li>
        
      <li>torchelastic.tsm.driver.api</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for torchelastic.tsm.driver.api</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Copyright (c) Facebook, Inc. and its affiliates.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This source code is licensed under the BSD-style license found in the</span>
<span class="c1"># LICENSE file in the root directory of this source tree.</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>


<div class="viewcode-block" id="Resources"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Resources">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Resources</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents resource requirements for a ``Container``.</span>

<span class="sd">    Arguments:</span>
<span class="sd">            cpu: number of cpu cores (note: not hyper threads)</span>
<span class="sd">            gpu: number of gpus</span>
<span class="sd">            memMB: MB of ram</span>
<span class="sd">            capabilities: additional hardware specs (interpreted by scheduler)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">memMB</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">capabilities</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">original</span><span class="p">:</span> <span class="s2">&quot;Resources&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">capabilities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies a resource and applies new capabilities. If the same capabilities</span>
<span class="sd">        are present in the original resource and as parameter, the one from parameter</span>
<span class="sd">        will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res_capabilities</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">original</span><span class="o">.</span><span class="n">capabilities</span><span class="p">)</span>
        <span class="n">res_capabilities</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">capabilities</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Resources</span><span class="p">(</span>
            <span class="n">cpu</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">memMB</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">memMB</span><span class="p">,</span>
            <span class="n">capabilities</span><span class="o">=</span><span class="n">res_capabilities</span><span class="p">,</span>
        <span class="p">)</span></div>


<span class="c1"># sentinel value used for cases when resource does not matter (e.g. ignored)</span>
<span class="n">NULL_RESOURCE</span><span class="p">:</span> <span class="n">Resources</span> <span class="o">=</span> <span class="n">Resources</span><span class="p">(</span><span class="n">cpu</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">memMB</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Container">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the specifications of the container that instances of ``Roles``</span>
<span class="sd">    run on. Maps to the container abstraction that the underlying scheduler</span>
<span class="sd">    supports. This could be an actual container (e.g. Docker) or a physical</span>
<span class="sd">    instance depending on the scheduler.</span>

<span class="sd">    An ``image`` is a software bundle that is installed on a ``Container``.</span>
<span class="sd">    The container on the scheduler dictates what an image actually is.</span>
<span class="sd">    An image could be as simple as a tar-ball or map to a docker image.</span>
<span class="sd">    The scheduler typically knows how to &quot;pull&quot; the image given an</span>
<span class="sd">    image name (str), which could be a simple name (e.g. docker image) or a url</span>
<span class="sd">    (e.g. s3://path/my_image.tar).</span>

<span class="sd">    Usage:</span>

<span class="sd">    ::</span>

<span class="sd">     my_container = Container(image=&quot;pytorch/torch:1&quot;)</span>
<span class="sd">                       .require(Resources(cpu=1, gpu=1, memMB=500))</span>
<span class="sd">                       .ports(tcp_store=8080, tensorboard=8081)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resources</span><span class="p">:</span> <span class="n">Resources</span> <span class="o">=</span> <span class="n">NULL_RESOURCE</span>
    <span class="n">port_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">require</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resources</span><span class="p">:</span> <span class="n">Resources</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Container&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets resource requirements on the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Container&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a port mapping for the container</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="o">**</span><span class="n">kwargs</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="c1"># sentinel value used to represent missing string attributes, such as image or entrypoint</span>
<span class="n">MISSING</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;MISSING&gt;&quot;</span>

<span class="c1"># sentinel value used as the &quot;zero&quot; element in the container group</span>
<span class="n">NULL_CONTAINER</span><span class="p">:</span> <span class="n">Container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">MISSING</span><span class="p">)</span>


<div class="viewcode-block" id="macros"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.macros">[docs]</a><span class="k">class</span> <span class="nc">macros</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines macros that can be used with ``Role.entrypoint`` and ``Role.args``.</span>
<span class="sd">    The macros will be substituted at runtime to their actual values.</span>

<span class="sd">    Available macros:</span>

<span class="sd">    1. ``img_root`` - root directory of the pulled image on the container</span>
<span class="sd">    2. ``app_id`` - application id (same as the return value of ``session.run(app)``)</span>
<span class="sd">    3. ``replica_id`` - unique id for each instance of a replica of a Role,</span>
<span class="sd">                        for instance a role with 3 replicas could have the 0, 1, 2</span>
<span class="sd">                        as replica ids. Note that when the container fails and is</span>
<span class="sd">                        replaced, the new container will have the same ``replica_id``</span>
<span class="sd">                        as the one it is replacing. For instance if node 1 failed and</span>
<span class="sd">                        was replaced by the scheduler the replacing node will also</span>
<span class="sd">                        have ``replica_id=1``.</span>

<span class="sd">    Example:</span>

<span class="sd">    ::</span>

<span class="sd">     # runs: hello_world.py --app_id ${app_id}</span>
<span class="sd">     trainer = Role(name=&quot;trainer&quot;).runs(&quot;hello_world.py&quot;, &quot;--app_id&quot;, macros.app_id)</span>
<span class="sd">     app = Application(&quot;train_app&quot;).of(trainer)</span>
<span class="sd">     app_id = session.run(app)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">img_root</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{img_root}</span><span class="s2">&quot;</span>
    <span class="n">app_id</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{app_id}</span><span class="s2">&quot;</span>
    <span class="n">replica_id</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{replica_id}</span><span class="s2">&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">substitute</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">img_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">replica_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">args_sub</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span>
                <span class="n">img_root</span><span class="o">=</span><span class="n">img_root</span><span class="p">,</span> <span class="n">app_id</span><span class="o">=</span><span class="n">app_id</span><span class="p">,</span> <span class="n">replica_id</span><span class="o">=</span><span class="n">replica_id</span>
            <span class="p">)</span>
            <span class="n">args_sub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args_sub</span></div>


<div class="viewcode-block" id="Role"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Role">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Role</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A set of nodes that perform a specific duty within the ``Application``.</span>
<span class="sd">    Examples:</span>

<span class="sd">    1. Distributed data parallel app - made up of a single role (trainer).</span>

<span class="sd">    2. App with parameter server - made up of multiple roles (trainer, ps).</span>

<span class="sd">    Usage:</span>

<span class="sd">    ::</span>

<span class="sd">     trainer = Role(name=&quot;trainer&quot;)</span>
<span class="sd">                 .runs(&quot;my_trainer.py&quot;, &quot;--arg&quot;, &quot;foo&quot;, ENV_VAR=&quot;FOOBAR&quot;)</span>
<span class="sd">                 .on(container)</span>
<span class="sd">                 .replicas(4)</span>

<span class="sd">    Arguments:</span>
<span class="sd">            name - name of the role</span>
<span class="sd">            entrypoint - command (within the container) to invoke the role</span>
<span class="sd">            args - commandline arguments to the entrypoint cmd</span>
<span class="sd">            env - environment variable mappings</span>
<span class="sd">            container - container to run in</span>
<span class="sd">            replicas - number of container replicas to run</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">entrypoint</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">container</span><span class="p">:</span> <span class="n">Container</span>
    <span class="n">num_replicas</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrypoint</span> <span class="o">=</span> <span class="n">MISSING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">NULL_CONTAINER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_replicas</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Role&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="o">*</span><span class="n">args</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="o">**</span><span class="n">kwargs</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="n">Container</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Role&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">replicas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Role&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_replicas</span> <span class="o">=</span> <span class="n">replicas</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="ElasticRole"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.ElasticRole">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ElasticRole</span><span class="p">(</span><span class="n">Role</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ``Role`` for which the user provided ``entrypoint`` is executed with the</span>
<span class="sd">    torchelastic agent (in the container). Note that the torchelastic agent</span>
<span class="sd">    invokes multiple copies of ``entrypoint``.</span>

<span class="sd">    For more information about torchelastic see</span>
<span class="sd">    `torchelastic quickstart docs &lt;http://pytorch.org/elastic/0.2.0/quickstart.html&gt;`__.</span>

<span class="sd">    .. important:: It is the responsibility of the user to ensure that the</span>
<span class="sd">                   container&#39;s image includes torchelastic. Since TSM has no</span>
<span class="sd">                   control over the build process of the image, it cannot</span>
<span class="sd">                   automatically include torchelastic in the container&#39;s image.</span>

<span class="sd">    The following example launches 2 ``replicas`` (nodes) of an elastic ``my_train_script.py``</span>
<span class="sd">    that is allowed to scale between 2 to 4 nodes. Each node runs 8 workers which are allowed</span>
<span class="sd">    to fail and restart a maximum of 3 times.</span>

<span class="sd">    .. warning:: ``replicas`` MUST BE an integer between (inclusive) ``nnodes``. That is,</span>
<span class="sd">                   ``ElasticRole(&quot;trainer&quot;, nnodes=&quot;2:4&quot;).replicas(5)`` is invalid and will</span>
<span class="sd">                   result in undefined behavior.</span>

<span class="sd">    ::</span>

<span class="sd">     # effectively runs:</span>
<span class="sd">     #    python -m torchelastic.distributed.launch</span>
<span class="sd">     #        --nproc_per_node 8</span>
<span class="sd">     #        --nnodes 2:4</span>
<span class="sd">     #        --max_restarts 3</span>
<span class="sd">     #        my_train_script.py --script_arg foo --another_arg bar</span>

<span class="sd">     elastic_trainer = ElasticRole(&quot;trainer&quot;, nproc_per_node=8, nnodes=&quot;2:4&quot;, max_restarts=3)</span>
<span class="sd">                        .runs(&quot;my_train_script.py&quot;, &quot;--script_arg&quot;, &quot;foo&quot;, &quot;--another_arg&quot;, &quot;bar&quot;)</span>
<span class="sd">                        .on(container)</span>
<span class="sd">                        .replicas(2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">torchelastic_launch_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">launch_kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrypoint</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;torchelastic.distributed.launch&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torchelastic_launch_args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">launch_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rdzv_backend&quot;</span><span class="p">,</span> <span class="s2">&quot;etcd&quot;</span><span class="p">)</span>
        <span class="n">launch_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rdzv_id&quot;</span><span class="p">,</span> <span class="n">macros</span><span class="o">.</span><span class="n">app_id</span><span class="p">)</span>
        <span class="n">launch_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">launch_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="c1"># treat boolean kwarg as a flag</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torchelastic_launch_args</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">torchelastic_launch_args</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ElasticRole&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">macros</span><span class="o">.</span><span class="n">img_root</span><span class="p">):</span>
            <span class="c1"># make entrypoint relative to {img_root} ONLY if it is not an absolute path</span>
            <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">macros</span><span class="o">.</span><span class="n">img_root</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchelastic_launch_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">entrypoint</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="o">**</span><span class="n">kwargs</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="k">class</span> <span class="nc">RunMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run mode of the application. Supported modes are:</span>

<span class="sd">    1. HEADLESS - Application is allowed to continue running even when the</span>
<span class="sd">                  hosting session has terminated. This is the default mode.</span>

<span class="sd">    2. MANAGED - Application&#39;s lifetime is bound to the hosting session. If</span>
<span class="sd">                 the session goes away, so will the app.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">HEADLESS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">MANAGED</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="Application"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Application">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a distributed application made up of multiple ``Roles``.</span>
<span class="sd">    Contains the necessary information for the driver to submit this</span>
<span class="sd">    app to the scheduler.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">roles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Role</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">run_mode</span><span class="p">:</span> <span class="n">RunMode</span> <span class="o">=</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">HEADLESS</span>
    <span class="n">is_attached</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">roles</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Application&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span> <span class="o">+=</span> <span class="p">[</span><span class="o">*</span><span class="n">roles</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="k">class</span> <span class="nc">AppState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    State of the application. An application starts from an initial</span>
<span class="sd">    ``UNSUBMITTED`` state and moves through ``SUBMITTED``, ``PENDING``,</span>
<span class="sd">    ``RUNNING`` states finally reaching a terminal state:</span>
<span class="sd">    ``SUCCEEDED``,``FAILED``, ``CANCELLED``.</span>

<span class="sd">    If the scheduler supports preemption, the app moves from a ``RUNNING``</span>
<span class="sd">    state to ``PENDING`` upon preemption.</span>

<span class="sd">    If the user stops the application, then the application state moves</span>
<span class="sd">    to ``STOPPED``, then to ``CANCELLED`` when the job is actually cancelled</span>
<span class="sd">    by the scheduler.</span>

<span class="sd">    1. UNSUBMITTED - app has not been submitted to the scheduler yet</span>
<span class="sd">    2. SUBMITTED - app has been successfully submitted to the scheduler</span>
<span class="sd">    3. PENDING - app has been submitted to the scheduler pending allocation</span>
<span class="sd">    4. RUNNING - app is running</span>
<span class="sd">    5. SUCCEEDED - app has successfully completed</span>
<span class="sd">    6. FAILED - app has unsuccessfully completed</span>
<span class="sd">    7. CANCELLED - app was cancelled before completing</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNSUBMITTED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SUBMITTED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RUNNING</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">SUCCEEDED</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">CANCELLED</span> <span class="o">=</span> <span class="mi">6</span>


<span class="n">_TERMINAL_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">AppState</span><span class="o">.</span><span class="n">SUCCEEDED</span><span class="p">,</span> <span class="n">AppState</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span> <span class="n">AppState</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">is_terminal</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AppState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">_TERMINAL_STATES</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AppStatus</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The runtime status of the ``Application``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">state</span><span class="p">:</span> <span class="n">AppState</span>
    <span class="n">num_restarts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ui_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">is_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_terminal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DescribeAppResponse</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Response object returned by ``Scheduler.describe(app)`` API. Contains</span>
<span class="sd">    the status and description of the application as known by the scheduler.</span>
<span class="sd">    For some schedulers implementations this response object has necessary</span>
<span class="sd">    and sufficient information to recreate an ``Application`` object in the</span>
<span class="sd">    absence of the hosting ``Session``. For these types of schedulers,</span>
<span class="sd">    the user can re-``run()`` the attached application. Otherwise the user</span>
<span class="sd">    can only call non-creating methods (e.g. ``wait()``, ``status()``, etc).</span>

<span class="sd">    Since this class is a data class and contains many member variables we</span>
<span class="sd">    keep the usage simple and provide a no-args constructor and chose to</span>
<span class="sd">    access the member vars directly rather than provide accessors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;NOT_SET&gt;&quot;</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">AppState</span> <span class="o">=</span> <span class="n">AppState</span><span class="o">.</span><span class="n">UNSUBMITTED</span>
    <span class="n">num_restarts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ui_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># TODO T72035216 add other fields that come back from the scheduler&#39;s describe</span>


<div class="viewcode-block" id="Scheduler"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Scheduler">[docs]</a><span class="k">class</span> <span class="nc">Scheduler</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An interface abstracting functionalities of a scheduler.</span>
<span class="sd">    Implementors need only implement those methods annotated with</span>
<span class="sd">    ``@abc.abstractmethod``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Scheduler.submit"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Scheduler.submit">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Application</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">RunMode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits the application to be run by the scheduler.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The application id that uniquely identifies the submitted app.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Scheduler.describe"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Scheduler.describe">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DescribeAppResponse</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Describes the specified application.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Application description or ``None`` if the app does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Scheduler.exists"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Scheduler.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``True`` if the app exists (was submitted), ``False`` otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">app_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">desc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_cancel_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kills the application. This method will only be called on an</span>
<span class="sd">        application that exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="Scheduler.cancel"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Scheduler.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels/kills the application. This method is idempotent within the same</span>
<span class="sd">        thread and is safe to call on the same application multiple times.</span>
<span class="sd">        However when called from multiple threads/processes on the same app</span>
<span class="sd">        the exact semantics of this method depends on the idempotency guarantees</span>
<span class="sd">        of the underlying scheduler API.</span>

<span class="sd">        .. note:: This method does not block for the application to reach a</span>
<span class="sd">                  cancelled state. To ensure that the application reaches a</span>
<span class="sd">                  terminal state use the ``wait`` API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">app_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_existing</span><span class="p">(</span><span class="n">app_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># do nothing if the app does not exist</span>
            <span class="k">return</span></div></div>


<span class="k">class</span> <span class="nc">UnknownAppException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised by ``Session`` APIs when either the application does not</span>
<span class="sd">    exist or the application is not owned by the session.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown app = </span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s2">. Did you forget to call session.run() or session.attach()?&quot;</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">AppNotReRunnableException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised when the application is not re-runnable. That is, one cannot have two run instances</span>
<span class="sd">    of the same application. See ``Session.attach()`` for when this is the case.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Application</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;App </span><span class="si">{</span><span class="n">app</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not re-runnable. To re-run attached apps, use a session/scheduler that supports such action.&quot;</span>
        <span class="p">)</span>


<div class="viewcode-block" id="Session"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session">[docs]</a><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entrypoint and client-facing API for TSM. Has the methods for the user to</span>
<span class="sd">    define and act upon ``Applications``. The ``Session`` is stateful and</span>
<span class="sd">    represents a logical workspace of the user. It can be backed by a service</span>
<span class="sd">    (e.g. TSM server) for persistence or can be standalone with no persistence</span>
<span class="sd">    meaning that the ``Session`` lasts only during the duration of the hosting</span>
<span class="sd">    process (see the ``attach()`` API for instructions on re-parenting apps</span>
<span class="sd">    between sessions).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="Session.name"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            The name of this session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Application</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">RunMode</span> <span class="o">=</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">HEADLESS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># input validation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No roles for app: </span><span class="si">{</span><span class="n">app</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Did you forget to call app.of(roles..)?&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">role</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No entrypoint for role: </span><span class="si">{</span><span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Did you forget to call role.runs(entrypoint, args, env)?&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">num_replicas</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Non-positive replicas for role: </span><span class="si">{</span><span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Did you forget to call role.replicas(positive_number)?&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="n">NULL_CONTAINER</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No container for role: </span><span class="si">{</span><span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Did you forget to call role.on(container)&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">resources</span> <span class="o">==</span> <span class="n">NULL_RESOURCE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No resources for container: </span><span class="si">{</span><span class="n">role</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">image</span><span class="si">}</span><span class="s2">. Did you forget to call container.require(resources)&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Application</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">RunMode</span> <span class="o">=</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">HEADLESS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the given application in the specified mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The application id that is used to call other action APIs on the app</span>

<span class="sd">        Raises:</span>
<span class="sd">            AppNotReRunnableException - if the session/scheduler does not support re-running attached apps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="Session.status"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.status">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AppStatus</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            The status of the application, or ``None`` if the app does not exist anymore</span>
<span class="sd">            (e.g. was stopped in the past and removed from the scheduler&#39;s backend).</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnknownAppException - if the app was never run or attached on this session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Session.wait"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.wait">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AppStatus</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Block waits (indefinitely) for the application to complete.</span>
<span class="sd">        Possible implementation:</span>

<span class="sd">        ::</span>

<span class="sd">         while(True):</span>
<span class="sd">             app_status = status(app)</span>
<span class="sd">             if app_status.is_terminal():</span>
<span class="sd">                 return</span>
<span class="sd">             sleep(10)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The terminal status of the application, or ``None`` if the app does not exist anymore</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnknownAppException - if the app was never run or attached on this session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Session.list"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.list">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Application</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the applications that were run with this session mapped by the app_id.</span>
<span class="sd">        The persistence of the session is implementation dependent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Session.stop"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.stop">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the application, effectively directing the scheduler to cancel</span>
<span class="sd">        the job.</span>

<span class="sd">        .. note:: This method returns as soon as the cancel request has been</span>
<span class="sd">                  submitted to the scheduler. The application will be in a</span>
<span class="sd">                  ``RUNNING`` state until the scheduler actually terminates</span>
<span class="sd">                  the job. If the scheduler successfully interrupts the job</span>
<span class="sd">                  and terminates it the final state will be ``CANCELLED``</span>
<span class="sd">                  otherwise it will be ``FAILED``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnknownAppException - if app was never run or attached on this session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Session.attach"><a class="viewcode-back" href="../../../../tsm_driver.html#torchelastic.tsm.driver.api.Session.attach">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Application</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attaches the application represented by the provided ``app_id``.</span>
<span class="sd">        If the app is already attached to this session, then does nothing</span>
<span class="sd">        and returns the existing ``Application`` object.</span>

<span class="sd">        Whether all action APIs are supported on the attached application</span>
<span class="sd">        is dependent on the specific implementation of the session and scheduler.</span>
<span class="sd">        For instance a ``StandaloneSession`` with no persistent backend cannot</span>
<span class="sd">        fully recreate the application without the underlying scheduler</span>
<span class="sd">        supporting a ``job_definition`` API that stores the job&#39;s template.</span>
<span class="sd">        Hence in this case, the user will not be able to re-run the attached</span>
<span class="sd">        app and can only call action APIs that require only the ``app_id``</span>
<span class="sd">        to execute. Please refer to the specific session and scheduler</span>
<span class="sd">        implementation documentations to understand the attach behavior,</span>
<span class="sd">        assumptions, and consequences.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The re-created application object</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnknownAppException - if app was never run or attached on this session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, PyTorch Elastic Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="../../../../_static/language_data.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
         <script src="../../../../_static/katex_autorenderer.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/features">Features</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>